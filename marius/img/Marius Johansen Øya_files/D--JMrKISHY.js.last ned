if (self.CavalryLogger) { CavalryLogger.start_js(["8hvZa"]); }

__d("KeyframesAssetDecoder",["Promise","BlobFactory","KeyframesPluginsLoader","KeyframesSchema","flatbuffers","promiseDone","requestIdleCallback"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("KeyframesSchema").Document,h="medium",i=a.URL||a.webkitURL||{};function j(a){a=new(b("flatbuffers").ByteBuffer)(a);return g.bufferHasIdentifier(a)?g.getRootAsDocument(a):null}function k(a){return new(b("Promise"))(function(b,c){var d=new Image();d.onload=function(){return b(d)};d.onerror=function(b){return c("Decode: error requesting image uri "+a)};d.src=a})}function l(b,c,d){return a.createImageBitmap?b.width<c||b.height<d?m(b,c,d).then(function(b){return a.createImageBitmap(b,0,0,c,d)["catch"](function(a){return b})}):a.createImageBitmap(b,0,0,b.width,b.height,{resizeWidth:c,resizeHeight:d,rezizeQuality:h})["catch"](function(a){return m(b,c,d)}):m(b,c,d)}function m(a,c,d){return new(b("Promise"))(function(b){var e=document.createElement("canvas");e.width=c;e.height=d;var f=e.getContext("2d");f.drawImage(a,0,0,c,d);b(e)})}function n(a,c,d){if(!i.createObjectURL)return b("Promise").reject("URL API not supported");var e=i.createObjectURL(a);c=k(e);b("promiseDone")(c,function(){return b("requestIdleCallback")(function(){return i.revokeObjectURL(e)})});return c}function o(c){if(b("BlobFactory").isSupported()){var d=c.contentArray();if(!d)return b("Promise").reject("Decode: tried to decode a null bitmap");var e=b("BlobFactory").getBlob([d]),f=c.size().width(),g=c.size().height();return a.createImageBitmap?a.createImageBitmap(e,0,0,f,g)["catch"](function(a){return n(e,f,g)}):n(e,f,g)}return b("Promise").reject("Decode: browser does not support bitmap creation")}function p(a){var b=[];for(var c=a.pluginsLength()-1;c>=0;c--)b.unshift(a.plugins(c));return b.length?b:null}function q(a){var b=[];for(var c=a.bitmapsLength()-1;c>=0;c--)b.unshift(a.bitmaps(c));return b}function r(a){var b={};for(var c=0;c<a.length;c++){var d=a[c].name();d&&(b[d]={index:c,width:a[c].size().width(),height:a[c].size().height()})}return b}function s(a){var b=[];for(var c,d=a.subdocumentsLength()-1;d>=0;d--)c=a.subdocuments(d),b.unshift(c);return b}function t(a){a=j(a);return!a?b("Promise").reject("Decode: could not create flatbuffer doc"):u(a)}function u(a){var c=q(a),d=r(c);c=c.filter(function(a){return a.contentLength()||!a.name()}).map(o);var e=s(a).map(u),f=p(a);f=f?b("KeyframesPluginsLoader").fromPluginTable(f):b("Promise").resolve(null);return b("Promise").all([b("Promise").all(c),f,b("Promise").all(e)]).then(function(b){var c=b[0],e=b[1];b=b[2];return{bitmaps:c,bitmapNames:d,doc:a,pluginsLoader:e,subassets:b}})}function v(a){__p&&__p();var c=String.fromCharCode.apply(null,a.subarray(0,3));if(c!=="KFZ")return b("Promise").reject("Decode package: invalid identifier");c=a[3];if(c!==1)return b("Promise").reject("Decode package: unsupported version");c=new DataView(a.buffer);var d=c.getUint16(4,!0);if(!d)return b("Promise").reject("Decode package: 0 document count");var e=2+4+d*4,f=[];for(var g=0,e=e;g<d;g++){var h=c.getUint32(6+g*4,!0);f.push(a.subarray(e,e+h));e+=h}return b("Promise").resolve(f)}function w(a){return!Uint8Array?b("Promise").reject("Decode: typed arrays not supported"):b("Promise").resolve(new Uint8Array(a))}function x(a,c){__p&&__p();var d={},e=[],f=Object.entries(a);a=function(){var a=f[g],h=a[0];a=a[1];a=c(a,h);e.push(a);b("promiseDone")(a,function(a){return d[h]=a})};for(var g=0;g<f.length;g++)a();return b("Promise").all(e).then(function(){return d})}function y(a,c,d){__p&&__p();if(!a.bitmapNames[c]){var e=Object.keys(a.bitmapNames).join(",");return b("Promise").reject("Decode: missing replacement bitmap name "+c+", available names: "+e)}e=a.bitmapNames[c];var f=e.index;c=e.width;e=e.height;return l(d,c,e).then(function(b){a.bitmaps[f]=b})}function z(a){var b=babelHelpers["extends"]({},a);b.bitmaps=a.bitmaps.slice();return b}var A={fromDocumentBytes:function(a){if(a instanceof ArrayBuffer)return w(a).then(t);else if(a instanceof Uint8Array)return t(a);return b("Promise").reject("Decode: unsupported byte container passed")},getDocumentByteSlicesFromPackage:function(a){return w(a).then(v)},replaceBitmapsWithURIs:function(a,b){return x(b,function(a){return k(a)}).then(function(b){return A.replaceBitmapsWithImageSources(a,b)})},replaceBitmapsWithImageSources:function(a,b){var c=z(a);return x(b,function(a,b){return y(c,b,a)}).then(function(){return c})}};e.exports=A}),null);